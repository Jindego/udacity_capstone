
version: 2.1

jobs:
  build-frontend:
    docker:
      - image: ubuntu:18.04
    steps:
      - checkout
      - run:
          name: Install Dependencies
          command: |
            # install sudo package 
            apt-get -y -qq update
            apt-get -y install sudo
            # install curl and docker
            sudo apt-get -y install curl 
            curl -fsSL https://download.docker.com/linux/debian/gpg | sudo apt-key add -
            sudo add-apt-repository "deb [arch=amd64] https://download.docker.com/linux/ubuntu bionic stable" -y
            sudo apt-get update
            sudo apt-get install -y docker-ce docker-ce-cli containerd.io

      - setup_remote_docker:
          version: 19.03.13
          docker_layer_caching: false

      - run:
          name: build image
          command: |
            docker build -t webserver_smithcf .
            docker image ls

      - run:
          name: push image
          command: |
            docker login -u "jindego" -p "$dockerpass"
            docker tag webserver_smithcf jindego/webserver_smithcf
            docker push jindego/webserver_smithcf


  deploy-change-to-kube:
    docker:
      - image: amazon/aws-cli
    steps:
      - checkout


workflows:
  # Name the workflow "welcome"
  welcome:
    # Run the welcome/run job in its own container
    jobs:
      - build-frontend